# Core
MISCITE_DB_URL=sqlite:///./data/miscite.db
MISCITE_STORAGE_DIR=./data/uploads
MISCITE_MAX_UPLOAD_MB=50
MISCITE_MAX_BODY_MB=55
MISCITE_MAX_UNPACKED_MB=250
MISCITE_SESSION_DAYS=14
MISCITE_LOGIN_CODE_TTL_MINUTES=15
MISCITE_LOGIN_CODE_LENGTH=6
MISCITE_MAILGUN_API_KEY=
MISCITE_MAILGUN_DOMAIN=
MISCITE_MAILGUN_SENDER=
MISCITE_MAILGUN_BASE_URL=https://api.mailgun.net/v3
MISCITE_TURNSTILE_SITE_KEY=
MISCITE_TURNSTILE_SECRET_KEY=
MISCITE_TURNSTILE_VERIFY_URL=https://challenges.cloudflare.com/turnstile/v0/siteverify
MISCITE_LOG_LEVEL=INFO
MISCITE_API_TIMEOUT_SECONDS=20
MISCITE_CACHE_ENABLED=true
MISCITE_CACHE_DIR=./data/cache
MISCITE_CACHE_LLM_TTL_DAYS=30
MISCITE_CACHE_HTTP_TTL_DAYS=30
MISCITE_CACHE_TEXT_TTL_DAYS=30
MISCITE_TEXT_EXTRACT_BACKEND=markitdown
MISCITE_TEXT_EXTRACT_TIMEOUT_SECONDS=120
MISCITE_TEXT_EXTRACT_SUBPROCESS=true
MISCITE_TEXT_EXTRACT_PROCESS_CONTEXT=auto
MISCITE_ACCELERATOR=cpu
MISCITE_WORKER_PROCESSES=1
MISCITE_WORKER_POLL_SECONDS=1.5
MISCITE_COOKIE_SECURE=false
MISCITE_TRUST_PROXY=false
MISCITE_RELOAD=true

# Ops modes
MISCITE_MAINTENANCE_MODE=false
MISCITE_MAINTENANCE_MESSAGE=Maintenance in progress. Uploads are temporarily disabled.
MISCITE_LOAD_SHED_MODE=false
MISCITE_ACCESS_TOKEN_DAYS=7
MISCITE_EXPOSE_SENSITIVE_REPORT_FIELDS=false

# Rate limits
MISCITE_RATE_LIMIT_ENABLED=true
MISCITE_RATE_LIMIT_WINDOW_SECONDS=60
MISCITE_RATE_LIMIT_LOGIN_REQUEST=12
MISCITE_RATE_LIMIT_LOGIN_VERIFY=12
MISCITE_RATE_LIMIT_UPLOAD=6
MISCITE_RATE_LIMIT_REPORT_ACCESS=20
MISCITE_RATE_LIMIT_EVENTS=120
MISCITE_RATE_LIMIT_STREAM=6
MISCITE_RATE_LIMIT_API=120

# Job health
MISCITE_JOB_STALE_SECONDS=3600
MISCITE_JOB_STALE_ACTION=fail
MISCITE_JOB_MAX_ATTEMPTS=2
MISCITE_JOB_REAP_INTERVAL_SECONDS=60

# Upload scanning (optional)
MISCITE_UPLOAD_SCAN_ENABLED=false
MISCITE_UPLOAD_SCAN_COMMAND=clamdscan --no-summary {path}
MISCITE_UPLOAD_SCAN_TIMEOUT_SECONDS=45

# LLM (OpenRouter) - required
OPENROUTER_API_KEY=
MISCITE_LLM_MODEL=google/gemini-3-flash-preview
MISCITE_ENABLE_LLM_INAPPROPRIATE=true
MISCITE_LLM_MAX_CALLS=25
MISCITE_LLM_PARSE_MODEL=google/gemini-3-flash-preview
MISCITE_LLM_MATCH_MODEL=google/gemini-3-flash-preview
MISCITE_LLM_DEEP_ANALYSIS_MODEL=google/gemini-3-flash-preview
MISCITE_LLM_MATCH_MAX_CALLS=50
MISCITE_LLM_BIB_PARSE_MAX_CHARS=120000
MISCITE_LLM_BIB_PARSE_MAX_REFS=400
MISCITE_LLM_CITATION_PARSE_MAX_CHARS=120000
MISCITE_LLM_CITATION_PARSE_MAX_LINES=2000
MISCITE_LLM_CITATION_PARSE_MAX_CANDIDATE_CHARS=60000

# Optional local NLI (GPU/CPU)
MISCITE_ENABLE_LOCAL_NLI=false
MISCITE_LOCAL_NLI_MODEL=MoritzLaurer/DeBERTa-v3-base-mnli-fever-anli

# Deep analysis (optional, can be expensive)
MISCITE_ENABLE_DEEP_ANALYSIS=false
MISCITE_ENABLE_DEEP_ANALYSIS_LLM_KEY_SELECTION=true
MISCITE_ENABLE_DEEP_ANALYSIS_LLM_SUGGESTIONS=true
MISCITE_DEEP_ANALYSIS_MIN_CONFIDENCE=0.55
MISCITE_DEEP_ANALYSIS_MAX_ORIGINAL_REFS=400
MISCITE_DEEP_ANALYSIS_PAPER_EXCERPT_MAX_CHARS=6000
MISCITE_DEEP_ANALYSIS_MAX_NODES=2500
MISCITE_DEEP_ANALYSIS_MAX_EDGES=50000
MISCITE_DEEP_ANALYSIS_MAX_WORKERS=8
MISCITE_DEEP_ANALYSIS_MAX_REFERENCES_PER_WORK=80
MISCITE_DEEP_ANALYSIS_MAX_SECOND_HOP_SEEDS=500
MISCITE_DEEP_ANALYSIS_MAX_TOTAL_CITING_REFS=1000
MISCITE_DEEP_ANALYSIS_MAX_CITING_REFS_FOR_SECOND_HOP=800
MISCITE_DEEP_ANALYSIS_DISPLAY_MAX_KEY_REFS=25
MISCITE_DEEP_ANALYSIS_DISPLAY_MAX_PER_CATEGORY=20
MISCITE_DEEP_ANALYSIS_DISPLAY_MAX_OPENALEX_FETCHES=140

# Metadata sources
MISCITE_CROSSREF_MAILTO=you@example.com
MISCITE_CROSSREF_USER_AGENT=miscite/0.1 (mailto:you@example.com)

# Datasets (local files)
MISCITE_RETRACTIONWATCH_CSV=./data/datasets/retraction-watch-data/retraction_watch.csv
MISCITE_PREDATORY_CSV=./data/datasets/predatory.csv

# Predatory list auto-sync (Google Sheets)
MISCITE_PREDATORY_SYNC_ENABLED=false
MISCITE_PREDATORY_SYNC_INTERVAL_HOURS=24
MISCITE_PREDATORY_PUBLISHERS_URL=https://docs.google.com/spreadsheets/d/1BHM4aJljhbOAzSpkX1kXDUEvy6vxREZu5WJaDH6M1Vk/edit?usp=sharing
MISCITE_PREDATORY_JOURNALS_URL=https://docs.google.com/spreadsheets/d/1Qa1lAlSbl7iiKddYINNsDB4wxI7uUA4IVseeLnCc5U4/edit?gid=0#gid=0

# Optional list APIs (remote)
MISCITE_RETRACTION_API_ENABLED=false
MISCITE_RETRACTION_API_MODE=lookup
MISCITE_RETRACTION_API_URL=
MISCITE_RETRACTION_API_TOKEN=

MISCITE_PREDATORY_API_ENABLED=false
MISCITE_PREDATORY_API_MODE=lookup
MISCITE_PREDATORY_API_URL=
MISCITE_PREDATORY_API_TOKEN=

# Retraction Watch dataset auto-sync (Crossref-hosted GitLab repo)
MISCITE_RW_SYNC_ENABLED=false
MISCITE_RW_SYNC_METHOD=git
MISCITE_RW_SYNC_INTERVAL_HOURS=24
MISCITE_RW_GIT_REPO=https://gitlab.com/crossref/retraction-watch-data
MISCITE_RW_GIT_DIR=./data/datasets/retraction-watch-data
MISCITE_RW_HTTP_URL=https://gitlab.com/crossref/retraction-watch-data/-/raw/main/retraction_watch.csv?ref_type=heads&inline=false

# Billing (Stripe)
MISCITE_BILLING_ENABLED=false
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRICE_ID=
STRIPE_SUCCESS_URL=http://localhost:8000/billing/success
STRIPE_CANCEL_URL=http://localhost:8000/billing/cancel
